@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer localizer
@model ManageEmployersViewModel
@{
	ViewData["Title"] = "Manage Employers";
}
<main class="col-lg-10 offset-lg-2">
	<nav class="d-flex justify-content-between bg-white align-items-center p-4 border__bottom">
		<div class="d-none d-lg-block">
			<h4 class="fw-semibold" style="font-size: 22px;">Manage Employees</h4>
		</div>

		<div class="d-flex align-items-center">
			<input type="text" placeholder="Search by Account number" class="search_input me-2">
			<a class="btn_small nav-item">
				<img src="../assets/svg/search.svg" alt="" srcset="">
			</a>
			<a class="btn_small nav-item">
				<img src="../assets/svg/filters.svg" alt="" srcset="">
			</a>
		</div>

		<div>
			@await Html.PartialAsync("_CulturePartial")
		</div>
	</nav>

	<div x-data="{active_tab : @Model.ActiveTab}">
		<div class="mx-4">
			<ul class="d-flex align-items-center gap-4 nav__tabs__container pt-4">
				<li class="p-3" :class="{ 'nav__link__tab__active':  active_tab == 1 }"
					@@click="active_tab = 1">List of Employees</li>
				<li class="p-3" :style="active_tab!=2 ? 'color:#BEBEBE':'' " :class="{ 'nav__link__tab__active':  active_tab == 2 }">Employee Details</li>
				<li class="p-3" :class="{ 'nav__link__tab__active':  active_tab == 3 }"
					@@click="active_tab = 3">Add new Employee</li>
			</ul>

			<div class="mt-4" x-show="active_tab == 1">
				<div class="row">
					<div class="col-lg-12">
						<table class="table">
							<thead class="thead-dark">
								<tr class="bg_primary text-white">
									<th scope="col" style="padding:1rem;">Name</th>
									<th scope="col" style="padding:1rem;text-align:center">Email</th>
									<th scope="col" style="padding:1rem;text-align:center">Phone Number</th>
									<th scope="col" style="padding:1rem;text-align:center">Manage</th>
								</tr>
							</thead>
							<tbody>

								@if (Model.Employers != null && Model.Employers.Any())
								{
									@foreach (var e in Model.Employers)
									{
										<tr class="border">
											<th style="padding:1rem;">@e.FirstName  @e.LastName</th>
											<td style="padding:1rem;text-align:center">@e.Email</td>
											<td style="padding:1rem;text-align:center">@e.PhoneNumber</td>
											<td style="padding:1rem;text-align:center"><a @@click="active_tab = 2" data-eId="@e.Id" style="border-radius: 4px;text-align:center" class="bg_primary nav-item text-white text-center p-2 manageEmployer">Manage</a></td>
										</tr>
									}
								}


							</tbody>
						</table>
					</div>
				</div>
			</div>

			<div id="employerDetails" class="mt-4" x-show="active_tab == 2"></div>

			<div class="mt-4" x-show="active_tab == 3">
				<div class="col-lg-10 mx-auto py-4">
					<form asp-action="AddUpdateEmployer" asp-controller="Employers" asp-area="BackOffice" method="post">
						<div asp-validation-summary="All" class="text-danger"></div>
						<input type="hidden" asp-for="Employer.Id" />
						<div v class="row">
							<div class="col-lg-12">
								<div class="row py-4">
									<div class="col-4">
										<div class="d-flex flex-column  fs-4">
											<label for="first_name">First Name</label>
											<input asp-for="Employer.FirstName" class="text__input mt-1" placeholder="">
											<span asp-validation-for="Employer.FirstName" class="text-danger"></span>

										</div>
										<div class="d-flex flex-column  fs-4">
											<label for="first_name">Last Name</label>
											<input asp-for="Employer.LastName" class="text__input mt-1" placeholder="">
											<span asp-validation-for="Employer.LastName" class="text-danger"></span>

										</div>
										<div class="d-flex flex-column mt-3 fs-4">
											<label for="first_name">Email</label>
											<input asp-for="Employer.Email" class="text__input mt-1" placeholder="">
											<span asp-validation-for="Employer.Email" class="text-danger"></span>
										</div>
										<div class="d-flex flex-column col-12 fs-4 mt-3">
											<label for="first_name">Phone number</label>
											<input asp-for="Employer.PhoneNumber" class="text__input mt-1" placeholder="">
											<span asp-validation-for="Employer.PhoneNumber" class="text-danger"></span>
										</div>

										<div class="d-flex flex-column col-12 fs-4 mt-3">
											<label for="first_name">Address</label>
											<input asp-for="Employer.AddressLine1" class="text__input mt-1" placeholder="Address Line 1">
											<span asp-validation-for="Employer.AddressLine1" class="text-danger"></span>
										</div>

										<div class="d-flex flex-column col-12 fs-4">
											<input asp-for="Employer.AddressLine2" class="text__input mt-1" placeholder="Address Line 2">
											<span asp-validation-for="Employer.AddressLine2" class="text-danger"></span>
										</div>

										<div class="d-flex flex-column col-12 fs-4">
											<input asp-for="Employer.City" class="text__input mt-1" placeholder="City">
											<span asp-validation-for="Employer.City" class="text-danger"></span>
										</div>
										<div class="d-flex flex-column col-12 fs-4">
											<input asp-for="Employer.Zip" class="text__input mt-1" placeholder="Zip Code">
											<span asp-validation-for="Employer.Zip" class="text-danger"></span>
										</div>

										<div class="d-flex flex-column col-12 fs-4">
											<input asp-for="Employer.Country" class="text__input mt-1" placeholder="Country">
											<span asp-validation-for="Employer.Country" class="text-danger"></span>
										</div>

										<div class="d-flex flex-column col-12 fs-4">
											<input asp-for="Employer.Region" class="text__input mt-1" placeholder="Region">
											<span asp-validation-for="Employer.Region" class="text-danger"></span>
										</div>
									</div>
									<div class="col-6 offset-1">
										<p>Permission List</p>
										<div class="d-flex flex-column gap-3">

											@for (var i = 0; i < Model.EPermissions.Count; i++)
											{
												<div class="d-flex align-items-center justify-content-between pb-2 border-bottom-1">

													<div>
														@Html.CheckBoxFor(x => x.EPermissions[i].IsSelected, new { @class="form-check-input", style="transform: scale(1.2);" })
														@Html.HiddenFor(x => x.EPermissions[i].Permission.Id)
														@Html.HiddenFor(x => x.EPermissions[i].Permission.Name)
														@Html.DisplayFor(model => model.EPermissions[i].Permission.Name,new { @class="form-check-label", style="margin-left: 0.5rem;" })

													</div>

													<div class="d-flex gap-3 align-items-center justify-content-between">
														@Html.RadioButtonFor(model => model.EPermissions[i].SelectedPermission,PermissionType.View, new { style="transform: scale(1.2);" } )
														@Html.Label(PermissionType.View.ToString())
														@Html.RadioButtonFor(model => model.EPermissions[i].SelectedPermission,PermissionType.Update, new { style="transform: scale(1.2);" } )
														@Html.Label(PermissionType.Update.ToString())
													</div>

												</div>
											}

										</div>
									</div>
								</div>
							</div>

							<div class="mt-5 text-end">
								<button type="button" class="btn_outline fs-5 fw-600"
										style="margin-right: 1rem;">
									Cancel
								</button>
								<button type="submit"
										class="btn_solid fs-5 fw-600 bg_primary_hover text-white" style="margin-right: 1rem;">
									Add
								</button>
							</div>
						</div>
					</form>
				</div>
			</div>

		</div>
	</div>
</main>

@section Scripts{
	<script>

		$(".manageEmployer").click(function () {
			var cId = $(this).attr("data-eId");
			LoadEmployerDetails(cId);
		})

		function LoadEmployerDetails(cId) {
			$.ajax({
				type: "GET",
				async: true,
				url: '/BackOffice/Employers/LoadEmployerDetails',
				data: { "employerId": cId },
				success: function (data) {
					$('#employerDetails').html(data);
				},
				error: function (error) {
					alert('Error occured. Please try again later.');
				}
			});
		}




	</script>
}
