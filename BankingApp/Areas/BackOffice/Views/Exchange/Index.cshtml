@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer localizer
@model ManageExchangesViewModel
@{
	ViewData["Title"] = "Manage Exchnage";
}
<main class="col-lg-10 offset-lg-2">
	<nav class="d-flex justify-content-between bg-white align-items-center p-4 border__bottom">
		<div class="d-none d-lg-block">
			<h4 class="fw-semibold" style="font-size: 22px;">Manage Exchange</h4>
		</div>

		<div>
			@await Html.PartialAsync("_CulturePartial")
		</div>
	</nav>

	<div class="p-4">
		<div class="">
			<p class="fs-5 fw-800">Your base currency is USD ($)</p>
			<div class="mt-4">
				<form asp-action="AddUpdateExchange" asp-controller="Exchange" asp-area="BackOffice" method="post">

					<div class="row">
						<div class="d-flex flex-column col-3 fs-4">
							<label asp-for="Exchange.Name">Currency name</label>
							<input asp-for="Exchange.Name" class="text__input mt-1 p-2" placeholder="">
							<span asp-validation-for="Exchange.Name" class="text-danger"></span>

						</div>

						<div class="d-flex flex-column col-3 fs-4">
							<label asp-for="Exchange.Symbol">Currency Symbol</label>
							<input asp-for="Exchange.Symbol" class="text__input mt-1 p-2" placeholder="">
							<span asp-validation-for="Exchange.Symbol" class="text-danger"></span>
						</div>

						<div class="d-flex flex-column col-3 fs-4">
							<label asp-for="Exchange.MarketRate"> Market Rate </label>
							<input asp-for="Exchange.MarketRate" class="text__input mt-1 p-2" placeholder="">
							<span asp-validation-for="Exchange.MarketRate" class="text-danger"></span>
						</div>

						<div class="row align-items-end mt-4">
							<div class="d-flex flex-column col-3 fs-4">
								<label for="first_name"> Selling Rate </label>
								<input asp-for="Exchange.SellingRate" class="text__input mt-1 p-2" placeholder="">
								<span asp-validation-for="Exchange.SellingRate" class="text-danger"></span>
							</div>
							<div class="d-flex flex-column col-3 fs-4">
								<label for="first_name"> Buying Rate </label>
								<input asp-for="Exchange.BuyingRate" class="text__input mt-1 p-2" placeholder="">
								<span asp-validation-for="Exchange.BuyingRate" class="text-danger"></span>
							</div>

							<div class="d-flex flex-column col-3 fs-4">
								<label for="first_name"> Spread % </label>
								<input asp-for="Exchange.Spread" class="text__input mt-1 p-2" placeholder="" readonly>
								<span asp-validation-for="Exchange.Spread" class="text-danger"></span>
							</div>

							<div class="col-4 text-start">
								<button type="submit"
										class="btn_solid fs-4 bg_primary_hover mt-1 p-2 text-white">
									Add
								</button>
								<a href="/BackOffice/Exchange/RefreshExchageRates"
								   class="btn_solid fs-4 bg_primary_hover mt-1 p-2 text-white">
									Refresh
								</a>
							</div>
						</div>

					</div>
				</form>
				<div class="">
					<div class="mt-4">
						<table class="table">
							<thead class="thead-dark">
								<tr class="bg_primary text-white">
									<th scope="col" style="padding:1rem;">Currency</th>
									<th scope="col" style="padding:1rem;">Value</th>
									<th scope="col" style="padding:1rem;">% Spread</th>
									<th scope="col" style="padding:1rem;">Change</th>
									<th scope="col" style="padding:1rem;">% Change</th>
									<th scope="col" style="padding:1rem;">Date</th>
									<th scope="col" style="padding:1rem;"></th>
								</tr>
							</thead>
							<tbody>
								@if (Model.Exchanges != null && Model.Exchanges.Any())
								{
									foreach (var e in Model.Exchanges)
									{
										decimal changePercentage = 0;
										var change = @Model.Exchange.MarketRate - @Model.Exchange.MarketRatePreviousDay;
										if (change > 0)
											changePercentage = (change / @Model.Exchange.MarketRatePreviousDay) * 100;



										<tr class="border-1">
											<th style="padding:1rem;">@e.Symbol</th>
											<td style="padding:1rem;">@e.MarketRate</td>
											<td style="padding:1rem;">@e.Spread</td>
											<td style="padding:1rem;">
												<span style="padding: 7px 16px;"
											  class="badge bg_success_lite text_success_dark">@(change > 0 ? "+" : "")@change</span>
											</td>
											<td style="padding:1rem;">
												<span style="padding: 7px 16px;"
											  class="badge bg_danger_lite text_danger_dark">@(change > 0 ? "+" : "")@changePercentage%</span>
											</td>
											<td style="padding:1rem;">@e.LastUpdatedDate.ToString("g",CultureInfo.CurrentCulture)</td>
											<td style="padding:1rem" data-bs-toggle="modal"
										data-bs-target="#exampleModal">
												<a data-eId="@e.Id" style="border-radius: 4px;"
										   class="bg_primary nav-item text-white text-center px-3 p-2 manageExchange">
													<img src="../assets/svg/pen.svg" alt="">
												</a>
											</td>
										</tr>
									}
								}

							</tbody>
						</table>
						<div class="modal fade modal-xl" id="exampleModal" tabindex="-1"
							 aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content" style="padding:2rem;">
									<div class="d-flex justify-content-between align-items-center mb-4">
										<h3 class="text__heading">Update Currency</h3>
										<span class="nav-item" data-bs-dismiss="modal"><img src="../assets/svg/close.svg" alt="" srcset=""></button>
									</div>
									<div id="exchangeDetailsPartial"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
</main>
@section Scripts{

	<script>
		$(".manageExchange").click(function () {
			var cId = $(this).attr("data-eId");
			LoadExchangeDetails(cId);
		})

		function LoadExchangeDetails(cId) {
			$.ajax({
				type: "GET",
				async: true,
				url: '/BackOffice/Exchange/LoadExchnageDetails',
				data: { "exchnageId": cId },
				success: function (data) {
					$('#exchangeDetailsPartial').html(data);
				},
				error: function (error) {
					alert('Error occured. Please try again later.');
				}
			});
		}
	</script>
	<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>


}
